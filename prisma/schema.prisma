datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

model UserType {
  id    Int    @id @default(autoincrement())
  code  String @unique
  name  String

  users User[]
}

model User {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  country   String?
  userType  UserType @relation(fields: [userTypeId], references: [id])
  userTypeId Int

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model SocialPlatform {
  id    Int    @id @default(autoincrement())
  code  String @unique // 'tiktok', 'instagram'
  name  String

  socialAccounts InfluencerSocialAccount[]
  posts          Post[]
}

model Influencer {
  id            Int                      @id @default(autoincrement())
  name          String
  email         String?
  birthDate     DateTime?
  niche         String?
  referralCode  String?

  socialAccounts        InfluencerSocialAccount[]
  influencerCampaigns   InfluencerCampaign[]
  posts                 Post[]
  internalMetrics       InternalMetric[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InfluencerSocialAccount {
  id               Int            @id @default(autoincrement())
  influencer       Influencer     @relation(fields: [influencerId], references: [id])
  influencerId     Int
  socialPlatform   SocialPlatform @relation(fields: [socialPlatformId], references: [id])
  socialPlatformId Int

  handle     String
  profileUrl String?
  isActive   Boolean @default(true)

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt

  @@unique([influencerId, socialPlatformId])
}

model CampaignGoalType {
  id   Int    @id @default(autoincrement())
  code String @unique
  name String

  campaigns Campaign[]
}

model Campaign {
  id          Int              @id @default(autoincrement())
  name        String
  description String?
  country     String?
  startDate   DateTime
  endDate     DateTime?
  isActive    Boolean @default(true)

  primaryGoalType   CampaignGoalType? @relation(fields: [primaryGoalTypeId], references: [id])
  primaryGoalTypeId Int?

  influencerCampaigns InfluencerCampaign[]
  posts               Post[]
  internalMetrics     InternalMetric[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model InfluencerCampaign {
  id            Int         @id @default(autoincrement())
  influencer    Influencer  @relation(fields: [influencerId], references: [id])
  influencerId  Int
  campaign      Campaign    @relation(fields: [campaignId], references: [id])
  campaignId    Int

  agreedCost    Decimal?    @db.Decimal(12, 2)
  notes         String?
  createdAt     DateTime    @default(now())

  @@unique([influencerId, campaignId])
}

model ContentType {
  id   Int    @id @default(autoincrement())
  code String @unique // 'video', 'reel', 'story'
  name String

  posts Post[]
}

model Post {
  id               Int             @id @default(autoincrement())
  influencer       Influencer      @relation(fields: [influencerId], references: [id])
  influencerId     Int

  campaign         Campaign?       @relation(fields: [campaignId], references: [id])
  campaignId       Int?

  socialPlatform   SocialPlatform  @relation(fields: [socialPlatformId], references: [id])
  socialPlatformId Int

  contentType      ContentType?    @relation(fields: [contentTypeId], references: [id])
  contentTypeId    Int?

  url         String
  caption     String?
  publishedAt DateTime
  isTakenosContent Boolean @default(false)

  metrics    PostMetricSnapshot[]

  createdAt  DateTime @default(now())
  updatedAt  DateTime @updatedAt
}

model PostMetricSnapshot {
  id          Int    @id @default(autoincrement())
  post        Post   @relation(fields: [postId], references: [id])
  postId      Int
  snapshotDate DateTime

  views       Int?
  likes       Int?
  shares      Int?
  clicks      Int?
  conversions Int?
  revenue     Decimal? @db.Decimal(14, 2)
  roi         Decimal? @db.Decimal(10, 4)

  createdAt   DateTime @default(now())

  @@unique([postId, snapshotDate])
}

model InternalMetricType {
  id          Int             @id @default(autoincrement())
  code        String          @unique  // 'NUA', 'NU', 'NAU', etc.
  name        String
  description String?

  metrics     InternalMetric[]
}

model InternalMetric {
  id            Int               @id @default(autoincrement())
  campaign      Campaign          @relation(fields: [campaignId], references: [id])
  campaignId    Int

  influencer    Influencer?       @relation(fields: [influencerId], references: [id])
  influencerId  Int?

  metricType    InternalMetricType @relation(fields: [metricTypeId], references: [id])
  metricTypeId  Int

  metricDate    DateTime
  value         Decimal @db.Decimal(14, 4)

  createdAt     DateTime @default(now())

  @@unique([campaignId, influencerId, metricTypeId, metricDate])
}
